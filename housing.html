<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>청약 가점 계산기</title>
<style>
  body { font-family: 'Noto Sans KR', Arial, sans-serif; background-color: #f5f5f5; margin: 0; padding: 0; }
  .container { max-width: 500px; margin: 20px auto; background: #fff; padding: 20px 30px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
  h1 { text-align: center; color: #333; font-size: 1.5em; margin-bottom: 20px; }
  label { display: block; font-weight: 600; margin-top: 15px; color: #555; }
  input[type="text"], input[type="number"], input[type="date"], select {
    margin-top: 8px; padding: 12px; width: 100%; box-sizing: border-box;
    border: 1px solid #ccc; border-radius: 8px; font-size: 1em;
  }
  select {
    appearance: none; -webkit-appearance: none; -moz-appearance: none;
    background: #fff url('data:image/svg+xml;utf8,<svg fill="%23999" height="12" viewBox="0 0 24 24" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>') no-repeat right 12px center;
    background-size: 12px; padding-right: 36px;
  }
  button { margin-top: 15px; background-color: #007BFF; color: #fff; font-weight: 600; border: none; cursor: pointer; transition: background 0.3s; padding: 12px; width: 100%; border-radius: 8px; font-size: 1em; }
  button:hover { background-color: #0056b3; }
  #result { margin-top: 25px; padding: 15px; background: #e0f7fa; border-radius: 10px; font-size: 1.2em; font-weight: bold; text-align: center; color: #007BFF; white-space: pre-line; }
  @media (max-width: 480px) { 
    .container { padding: 15px 20px; } 
    h1 { font-size: 1.3em; } 
  }
</style>
</head>
<body>
<div class="container">
<h1>청약 가점 계산기</h1>
<form id="calculator">

<label>생년월일 (필수)</label>
<input type="date" id="birthDate" required>

<label>청약통장 가입일 (필수)</label>
<input type="date" id="subscriptionDate" required>

<label>혼인 여부</label>
<select id="maritalStatus" onchange="toggleMarriageInput()">
  <option value="single">미혼</option>
  <option value="married">기혼</option>
</select>

<div id="marriageInput" style="display:none;">
  <label>혼인신고일</label>
  <input type="date" id="marriageDate">
</div>

<label>부양가족 수 (본인 제외)</label>
<input type="number" id="familyCount" min="0" value="0">

<label>무주택 기간 계산</label>
<select id="housingExperience" onchange="toggleHousingInput()">
  <option value="none">주택 구매 경험 없음</option>
  <option value="has">주택 구매 경험 있음</option>
</select>

<div id="housingInput" style="display:none;">
  <label>무주택자가 된 날짜 (마지막 주택 처분일)</label>
  <input type="date" id="noHouseDate">
</div>

<button type="button" onclick="calculateScore()">계산하기</button>
</form>
<div id="result"></div>
</div>

<script>
// 오늘 날짜를 yyyy-mm-dd 형식으로 구함
const todayStr = new Date().toISOString().split("T")[0];
document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll('input[type="date"]').forEach(input => {
    input.max = todayStr;
  });
});

function toggleHousingInput() {
  const exp = document.getElementById('housingExperience').value;
  document.getElementById('housingInput').style.display = exp === 'has' ? 'block' : 'none';
}
function toggleMarriageInput() {
  const status = document.getElementById('maritalStatus').value;
  document.getElementById('marriageInput').style.display = status === 'married' ? 'block' : 'none';
}

function calculateScore() {
  const birth = new Date(document.getElementById('birthDate').value);
  const subDate = new Date(document.getElementById('subscriptionDate').value);
  const maritalStatus = document.getElementById('maritalStatus').value;
  const familyCount = parseInt(document.getElementById('familyCount').value) || 0;
  const housingExp = document.getElementById('housingExperience').value;

  if (!birth || !subDate) { alert("생년월일과 청약통장 가입일을 입력하세요."); return; }

  // 만 30세 기준일
  let age30Date = new Date(birth);
  age30Date.setFullYear(age30Date.getFullYear() + 30);

  let startDate;

  if (housingExp === 'none') {
    if (maritalStatus === 'married') {
      const marriageDateInput = document.getElementById('marriageDate').value;
      if (!marriageDateInput) { alert('혼인신고일을 입력하세요'); return; }
      const marriageDate = new Date(marriageDateInput);
      startDate = marriageDate < age30Date ? marriageDate : age30Date;
    } else {
      startDate = age30Date;
    }
  } else {
    const noHouseDate = new Date(document.getElementById('noHouseDate').value);
    if (!noHouseDate) { alert('무주택자가 된 날짜를 입력하세요'); return; }
    startDate = noHouseDate;
  }

  const today = new Date();
  const totalMonths = (today.getFullYear() - startDate.getFullYear()) * 12 + (today.getMonth() - startDate.getMonth());

  // ✅ 무주택 기간 점수 (공식표)
  let housingScore = 0;
  if (totalMonths < 12) housingScore = 2;
  else if (totalMonths < 24) housingScore = 4;
  else if (totalMonths < 36) housingScore = 8;
  else if (totalMonths < 48) housingScore = 12;
  else if (totalMonths < 60) housingScore = 16;
  else if (totalMonths < 72) housingScore = 20;
  else if (totalMonths < 84) housingScore = 24;
  else if (totalMonths < 96) housingScore = 28;
  else housingScore = 32;

  // ✅ 청약통장 가입기간 점수 (1년 1점, 최대 17점)
  const subYears = today.getFullYear() - subDate.getFullYear();
  const subMonths = today.getMonth() - subDate.getMonth();
  let subTotalYears = subYears + (subMonths >= 0 ? 0 : -1);
  if (subTotalYears >= 15) subTotalYears = 17;
  const subScore = Math.min(subTotalYears, 17);

  // ✅ 부양가족 점수 (본인 제외, 최대 35점)
  const familyScore = Math.min(familyCount * 5, 35);

  const totalScore = housingScore + subScore + familyScore;

  // ✅ 결과 표시 순서/명칭 수정
  document.getElementById('result').innerText = 
    `예상 청약 가점: ${totalScore}점\n(무주택: ${housingScore}, 부양가족: ${familyScore}, 청약통장: ${subScore})`;
}
</script>
</body>
</html>
